use rf24hub;


--DROP TABLE IF EXISTS battery;

CREATE TABLE battery
(
   battery_id       INT UNSIGNED   NOT NULL,
   battery_name     VARCHAR(20)    DEFAULT NULL,
   u_empty          FLOAT          DEFAULT NULL,
   u_nominal        FLOAT          DEFAULT NULL,
   battery_sel_txt  VARCHAR(20)    DEFAULT NULL,
   CONSTRAINT `PRIMARY` PRIMARY KEY (battery_id)
)
ENGINE=InnoDB;

INSERT INTO battery (battery_id,battery_name,u_empty,u_nominal,battery_sel_txt) 
VALUES
  (1,'2 Alkaline Zellen 3V',2.0,3.0,'2 Alka 3V'),
  (2,'2 NMH Akkus 2,4V',2.0,2.4,'2 NiMH 2,4V'),
  (3,'1 LiIo Zelle 3,7V',3.0,3.7,'1 LiIo 3,7V'),
  (9,'Netzspannung',3.0,3.7,'Netzspannung');

--DROP TABLE IF EXISTS gateway;

CREATE TABLE gateway
(
   gw_name   VARCHAR(40)    NOT NULL,
   gw_no     INT UNSIGNED   DEFAULT NULL,
   isActive  VARCHAR(1)     DEFAULT 'n'
)
ENGINE=InnoDB;

INSERT INTO gateway (gw_name,gw_no,isActive) 
VALUES
  ('rpi2.fritz.box',1,'j');

--DROP TABLE IF EXISTS node;

CREATE TABLE node
(
   node_id     INT UNSIGNED   NOT NULL,
   node_name   VARCHAR(50)    DEFAULT NULL,
   add_info    VARCHAR(500)   DEFAULT NULL,
   battery_id  INT UNSIGNED   DEFAULT NULL,
   html_show   CHAR(1)        DEFAULT NULL,
   html_order  INT UNSIGNED   DEFAULT NULL,
   pa_level    INT UNSIGNED   DEFAULT NULL,
   rec_level   INT UNSIGNED   DEFAULT NULL,
   mastered    CHAR(1)        DEFAULT NULL,
   volt_lv     FLOAT          DEFAULT NULL,
   lv_flag     CHAR(1)        DEFAULT NULL,
   CONSTRAINT `PRIMARY` PRIMARY KEY (node_id)
)
ENGINE=InnoDB;

ALTER TABLE node
  ADD CONSTRAINT battery_id FOREIGN KEY (battery_id)
  REFERENCES battery (battery_id) 
  ON UPDATE RESTRICT
  ON DELETE RESTRICT;

INSERT INTO node (node_id,node_name,add_info,battery_id,html_show,html_order,pa_level,rec_level,mastered,volt_lv,lv_flag) 
VALUES
  (101,'Node 101','',3,'y',1,3,1,'y',2.0,'n'),
  (105,'Bastelzimmer_sw','',3,'y',11,2,0,'y',3.6,'n'),
  (110,'Ankleidezimmer','',3,'y',5,3,0,'y',3.5,'n'),
  (201,'Aussenthermometer2','',1,'y',2,NULL,NULL,'y',2.0,'n'),
  (202,'Solarnode','Solarnode Testnetz',2,'y',3,3,0,'y',2.2,'n'),
  (240,'Testnode_240','',3,'y',100,3,0,'y',3.3,'n');

DROP TABLE IF EXISTS node_configdata;

CREATE TABLE node_configdata
(
   node_id  INT UNSIGNED   NOT NULL,
   channel  INT UNSIGNED   NOT NULL,
   value    FLOAT          DEFAULT NULL,
   utime    INT UNSIGNED   DEFAULT NULL,
   CONSTRAINT `PRIMARY` PRIMARY KEY (node_id, channel)
)
ENGINE=MEMORY;

--DROP TABLE IF EXISTS node_configitem;

CREATE TABLE node_configitem
(
   channel     INT UNSIGNED   NOT NULL,
   itemname    VARCHAR(200)   NOT NULL,
   min         FLOAT          NOT NULL,
   max         FLOAT          NOT NULL,
   readonly    CHAR(1)        DEFAULT 'n' NOT NULL,
   html_show   CHAR(1)        DEFAULT 'y' NOT NULL,
   html_order  INT UNSIGNED   DEFAULT NULL,
   CONSTRAINT `PRIMARY` PRIMARY KEY (channel)
)
ENGINE=InnoDB;

INSERT INTO node_configitem (channel,itemname,min,max,readonly,html_show,html_order) 
VALUES
  (91,'Aktive Entladung Level 1',1.0,20.0,'n','y',21),
  (92,'Aktive Entladung Level 2',1.0,20.0,'n','y',22),
  (93,'Aktive Entladung Level 3',1.0,20.0,'n','y',23),
  (94,'Load Ballancer Differenzspannung',0.01,1.0,'n','y',24),
  (95,'Display: Kontrast',0.0,100.0,'n','y',30),
  (96,'Display: Helligkeit',0.0,100.0,'n','y',31),
  (110,'Spannungsfaktor',0.1,10.0,'n','y',2),
  (111,'Spannungsoffset',-10.0,10.0,'n','y',3),
  (112,'Kritischer Spannungswert',1.0,5.0,'n','y',4),
  (113,'Schlafzeit in Sekunden (kritische Spannung)',10.0,32400.0,'n','y',5),
  (114,'Schlafzeit in Sekunden',10.0,32400.0,'n','y',10),
  (115,'Sekundenjustierung (aprox. millisec)',500.0,2000.0,'n','y',16),
  (116,'Wartezeit zwischen 2 Sendungen in ms',50.0,1000.0,'n','y',12),
  (117,'Maximale Anzahl f체r normale Sendungen',1.0,20.0,'n','y',13),
  (118,'Maximale Anzahl f체r Stopp Sendungen',1.0,2.0,'n','y',14),
  (119,'Schleifen ohne Sendung',0.0,20.0,'n','y',11),
  (120,'Sendest채rke (0=Min 1=Low 2=High 3=Max)',0.0,9.0,'n','y',91),
  (121,'Empfangsst채rke gemessen (0=Min 1=Low 2=High 3=Max)',0.0,9.0,'y','y',90),
  (125,'Softwareversion',0.0,0.0,'y','y',91);

--DROP TABLE IF EXISTS sensor;

CREATE TABLE sensor
(
   sensor_id    INT UNSIGNED   NOT NULL,
   sensor_name  VARCHAR(50)    DEFAULT NULL,
   add_info     VARCHAR(100)   DEFAULT NULL,
   node_id      INT UNSIGNED   DEFAULT NULL,
   channel      INT UNSIGNED   DEFAULT NULL,
   datatype     TINYINT        DEFAULT 0 NOT NULL,
   store_days   INT            DEFAULT NULL,
   fhem_dev     VARCHAR(50)    DEFAULT NULL,
   html_show    CHAR(1)        DEFAULT NULL,
   html_order   INT UNSIGNED   DEFAULT NULL,
   CONSTRAINT `PRIMARY` PRIMARY KEY (sensor_id)
)
ENGINE=InnoDB;

INSERT INTO sensor (sensor_id,sensor_name,add_info,node_id,channel,datatype,store_days,fhem_dev,html_show,html_order) 
VALUES
  (11,'Bastelzimmer_sw_temp','',105,1,0,-1,'','y',1),
  (12,'Feld1','',105,21,0,-1,'','y',2),
  (19,'Bastelzimmer_sw_ubatt','',105,79,0,-1,'','y',9),
  (21,'Solarzelle','',202,5,0,-1,'Solarzelle','y',1),
  (22,'Solarzelle2','',202,6,0,-1,'','y',2),
  (23,'u_batt1','',202,7,0,-1,'','y',3),
  (24,'Batt_Statusbits','',202,8,0,-1,'','y',4),
  (29,'Solarnode_ubatt','',202,79,0,-1,'','y',9),
  (31,'N110_temp','',110,1,0,-1,'','y',1),
  (32,'Feld1','',110,21,0,-1,'','y',2),
  (39,'N110_batt','',110,79,0,-1,'','y',9),
  (41,'N101_Temp','',101,1,0,-1,'','y',1),
  (42,'Feld1','',101,21,0,-1,'','y',2),
  (43,'Feld2','',101,22,0,-1,'','y',3),
  (44,'Feld3','',101,23,0,-1,'','y',4),
  (45,'Feld4','',101,24,0,-1,'','y',5),
  (49,'N101_Ubatt','',101,79,0,-1,'','y',9),
  (101,'N240_Temp','',240,1,0,-1,'','y',1),
  (102,'U_Batt','',240,79,0,-1,'','y',9);

--DROP TABLE IF EXISTS sensordata;

CREATE TABLE sensordata
(
   sensor_id  INT UNSIGNED   NOT NULL,
   utime      INT UNSIGNED   NOT NULL,
   value      FLOAT          DEFAULT NULL,
   CONSTRAINT `PRIMARY` PRIMARY KEY (sensor_id, utime)
)
ENGINE=InnoDB;

CREATE INDEX sensordata_utime_idx
   ON sensordata (utime ASC);
   
--DROP TABLE IF EXISTS sensordata_d;

CREATE TABLE sensordata_d
(
   sensor_id  INT UNSIGNED   NOT NULL,
   Utime      INT UNSIGNED   NOT NULL,
   Value      FLOAT          DEFAULT NULL,
   CONSTRAINT `PRIMARY` PRIMARY KEY (sensor_id, Utime)
)
ENGINE=MEMORY;

CREATE INDEX sensordata_d_utime
   ON sensordata_d (Utime);

--DROP TABLE IF EXISTS numbers;

CREATE TABLE sensordata_sum
(
   sensor_id  INT UNSIGNED   NOT NULL,
   anzahl     INT UNSIGNED   DEFAULT NULL
)
ENGINE=MEMORY;

CREATE TABLE numbers
(
   number  INT UNSIGNED   NOT NULL,
   CONSTRAINT `PRIMARY` PRIMARY KEY (number)
)
ENGINE=InnoDB;

INSERT INTO numbers (number) 
VALUES
  (1),
  (2),
  (3),
  (4),
  (5),
  (6),
  (7),
  (8),
  (9),
  (10),
  (11),
  (12),
  (13),
  (14),
  (15),
  (16),
  (17),
  (18),
  (19),
  (20),
  (21),
  (22),
  (23),
  (24),
  (25),
  (26),
  (27),
  (28),
  (29),
  (30),
  (31),
  (32),
  (33),
  (34),
  (35),
  (36),
  (37),
  (38),
  (39),
  (40),
  (41),
  (42),
  (43),
  (44),
  (45),
  (46),
  (47),
  (48),
  (49),
  (50),
  (51),
  (52),
  (53),
  (54),
  (55),
  (56),
  (57),
  (58),
  (59),
  (60),
  (61),
  (62),
  (63),
  (64),
  (65),
  (66),
  (67),
  (68),
  (69),
  (70),
  (71),
  (72),
  (73),
  (74),
  (75),
  (76),
  (77),
  (78),
  (79),
  (80),
  (81),
  (82),
  (83),
  (84),
  (85),
  (86),
  (87),
  (88),
  (89),
  (90),
  (91),
  (92),
  (93),
  (94),
  (95),
  (96),
  (97),
  (98),
  (99),
  (100),
  (101),
  (102),
  (103),
  (104),
  (105),
  (106),
  (107),
  (108),
  (109),
  (110),
  (111),
  (112),
  (113),
  (114),
  (115),
  (116),
  (117),
  (118),
  (119),
  (120),
  (121),
  (122),
  (123),
  (124),
  (125),
  (126),
  (127),
  (128),
  (129),
  (130),
  (131),
  (132),
  (133),
  (134),
  (135),
  (136),
  (137),
  (138),
  (139),
  (140),
  (141),
  (142),
  (143),
  (144),
  (145),
  (146),
  (147),
  (148),
  (149),
  (150),
  (151),
  (152),
  (153),
  (154),
  (155),
  (156),
  (157),
  (158),
  (159),
  (160),
  (161),
  (162),
  (163),
  (164),
  (165),
  (166),
  (167),
  (168),
  (169),
  (170),
  (171),
  (172),
  (173),
  (174),
  (175),
  (176),
  (177),
  (178),
  (179),
  (180),
  (181),
  (182),
  (183),
  (184),
  (185),
  (186),
  (187),
  (188),
  (189),
  (190),
  (191),
  (192),
  (193),
  (194),
  (195),
  (196),
  (197),
  (198),
  (199),
  (200),
  (201),
  (202),
  (203),
  (204),
  (205),
  (206),
  (207),
  (208),
  (209),
  (210),
  (211),
  (212),
  (213),
  (214),
  (215),
  (216),
  (217),
  (218),
  (219),
  (220),
  (221),
  (222),
  (223),
  (224),
  (225),
  (226),
  (227),
  (228),
  (229),
  (230),
  (231),
  (232),
  (233),
  (234),
  (235),
  (236),
  (237),
  (238),
  (239),
  (240),
  (241),
  (242),
  (243),
  (244),
  (245),
  (246),
  (247),
  (248),
  (249),
  (250),
  (251),
  (252),
  (253),
  (254),
  (255),
  (256),
  (257),
  (258),
  (259),
  (260),
  (261),
  (262),
  (263),
  (264),
  (265),
  (266),
  (267),
  (268),
  (269),
  (270),
  (271),
  (272),
  (273),
  (274),
  (275),
  (276),
  (277),
  (278),
  (279),
  (280),
  (281),
  (282),
  (283),
  (284),
  (285),
  (286),
  (287),
  (288),
  (289),
  (290),
  (291),
  (292),
  (293),
  (294),
  (295),
  (296),
  (297),
  (298),
  (299),
  (300),
  (301),
  (302),
  (303),
  (304),
  (305),
  (306),
  (307),
  (308),
  (309),
  (310),
  (311),
  (312),
  (313),
  (314),
  (315),
  (316),
  (317),
  (318),
  (319),
  (320),
  (321),
  (322),
  (323),
  (324),
  (325),
  (326),
  (327),
  (328),
  (329),
  (330),
  (331),
  (332),
  (333),
  (334),
  (335),
  (336),
  (337),
  (338),
  (339),
  (340),
  (341),
  (342),
  (343),
  (344),
  (345),
  (346),
  (347),
  (348),
  (349),
  (350),
  (351),
  (352),
  (353),
  (354),
  (355),
  (356),
  (357),
  (358),
  (359),
  (360),
  (361),
  (362),
  (363),
  (364),
  (365),
  (366),
  (367),
  (368),
  (369),
  (370),
  (371),
  (372),
  (373),
  (374),
  (375),
  (376),
  (377),
  (378),
  (379),
  (380),
  (381),
  (382),
  (383),
  (384),
  (385),
  (386),
  (387),
  (388),
  (389),
  (390),
  (391),
  (392),
  (393),
  (394),
  (395),
  (396),
  (397),
  (398),
  (399),
  (400),
  (401),
  (402),
  (403),
  (404),
  (405),
  (406),
  (407),
  (408),
  (409),
  (410),
  (411),
  (412),
  (413),
  (414),
  (415),
  (416),
  (417),
  (418),
  (419),
  (420),
  (421),
  (422),
  (423),
  (424),
  (425),
  (426),
  (427),
  (428),
  (429),
  (430),
  (431),
  (432),
  (433),
  (434),
  (435),
  (436),
  (437),
  (438),
  (439),
  (440),
  (441),
  (442),
  (443),
  (444),
  (445),
  (446),
  (447),
  (448),
  (449),
  (450),
  (451),
  (452),
  (453),
  (454),
  (455),
  (456),
  (457),
  (458),
  (459),
  (460),
  (461),
  (462),
  (463),
  (464),
  (465),
  (466),
  (467),
  (468),
  (469),
  (470),
  (471),
  (472),
  (473),
  (474),
  (475),
  (476),
  (477),
  (478),
  (479),
  (480),
  (481),
  (482),
  (483),
  (484),
  (485),
  (486),
  (487),
  (488),
  (489),
  (490),
  (491),
  (492),
  (493),
  (494),
  (495),
  (496),
  (497),
  (498),
  (499),
  (500);

